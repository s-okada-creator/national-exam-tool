<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ - å›½å®¶è©¦é¨“å¯¾ç­–ãƒ„ãƒ¼ãƒ«</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v={{ css_version }}">
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ“– å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</h1>
        </div>
    </header>

    <div class="container">
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>

        <div id="content" style="display: none;">
            <div class="question-container">
                <!-- å•é¡ŒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prev-btn">å‰ã¸</button>
                
                <div style="flex: 1; margin: 0 20px;">
                    <div style="text-align: center; margin-bottom: 10px;">
                        <span id="question-counter">1 / 1</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%;"></div>
                    </div>
                </div>
                
                <button class="btn" id="next-btn">æ¬¡ã¸</button>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-danger" id="finish-btn">ãƒ†ã‚¹ãƒˆçµ‚äº†</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app-v2.js') }}?v={{ js_version }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session');
            
            if (!sessionId) {
                alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                window.location.href = '/';
                return;
            }
            
            const loaded = await initSession(sessionId);
            if (!loaded) {
                alert('ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                window.location.href = '/';
                return;
            }
            
            // æœ€åˆã®å•é¡Œã‚’è¡¨ç¤º
            const question = getCurrentQuestion();
            if (question) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                displayQuestion(question);
                updateNavigation();
            }
            
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
            document.getElementById('prev-btn').addEventListener('click', previousQuestion);
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            
            // ãƒ†ã‚¹ãƒˆçµ‚äº†ãƒœã‚¿ãƒ³
            document.getElementById('finish-btn').addEventListener('click', function() {
                if (confirm('ãƒ†ã‚¹ãƒˆã‚’çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿãƒ¬ãƒãƒ¼ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚')) {
                    window.location.href = `/report/${sessionId}`;
                }
            });
        });
    </script>
</body>
</html>

